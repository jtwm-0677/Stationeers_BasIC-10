# QA Test Plan: v3.0.13 Bug Fixes

**Version:** 3.0.13
**Date:** 2025-12-04
**Tester:** Claude Code (QA Instance)

---

## Overview

This release includes major bug fixes for Visual Scripting:
1. Simulator support for DEVICE aliases (named devices)
2. Simulator device pool for batch operations (lb/sb)
3. Wire removal (3 methods)
4. Comment node code generation

---

## Test Suite

### 1. Simulator - Device Alias Resolution

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| SIM-01 | Register device alias | Create script with `DEVICE sensor "StructureGasSensor"`, load in simulator | Simulator shows `sensor` in device list with GasSensor properties |
| SIM-02 | Read via alias | Script: `temp = sensor.Temperature`, step through | `temp` receives Temperature value from sensor |
| SIM-03 | Write via alias | Script: `sensor.On = 1`, step through | Sensor device shows On = 1 |
| SIM-04 | Multiple aliases | Two DEVICE declarations for different prefabs | Both devices tracked separately |
| SIM-05 | Alias + d0 mixed | Script uses both `sensor.Temperature` and `d0.On` | Both work correctly |
| SIM-06 | Edit device values | Edit sensor Temperature in simulator UI | Value updates and affects script execution |

**Test Script for SIM-01 through SIM-03:**
```basic
DEVICE sensor "StructureGasSensor"
DEVICE cooler "StructureWallCooler"

VAR temp = 0

main:
    temp = sensor.Temperature
    IF temp > 295 THEN
        cooler.On = 1
    ELSE
        cooler.On = 0
    ENDIF
    YIELD
    GOTO main
```

---

### 2. Simulator - Device Pool (Batch Operations)

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| POOL-01 | Batch read average | Create 3 sensors with different temps, use lb | Returns average of temperatures |
| POOL-02 | Batch read sum | Use lb with Sum mode | Returns sum of values |
| POOL-03 | Batch read min | Use lb with Minimum mode | Returns minimum value |
| POOL-04 | Batch read max | Use lb with Maximum mode | Returns maximum value |
| POOL-05 | Batch write | Use sb to write to device type | All matching devices updated |

**Note:** Batch operations require hash of prefab name. Test via MCP or compiled IC10.

---

### 3. Wire Removal - Keyboard

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| WIRE-01 | Wire hover | Move mouse over a wire | Wire highlights (color change) |
| WIRE-02 | Wire select | Click on a wire | Wire shows selection (thicker, glow) |
| WIRE-03 | Wire deselect | Click on empty canvas | Wire returns to normal |
| WIRE-04 | Delete key | Select wire, press Delete | Wire removed, pins disconnected |
| WIRE-05 | Delete updates code | Delete wire, check code pane | Generated code reflects disconnection |

---

### 4. Wire Removal - Right-Click Menu

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| MENU-01 | Context menu | Right-click on a wire | Menu appears with "Delete Wire" option |
| MENU-02 | Delete via menu | Click "Delete Wire" in menu | Wire removed |
| MENU-03 | Menu cancel | Right-click wire, click elsewhere | Menu closes, wire unchanged |

---

### 5. Wire Removal - Drag to Disconnect

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| DRAG-01 | Start drag | Click on connected pin | Wire detaches, follows mouse as dashed line |
| DRAG-02 | Reconnect | Drag to compatible pin on different node | Wire connects to new pin |
| DRAG-03 | Disconnect | Drag to empty canvas, release | Wire deleted |
| DRAG-04 | Cancel drag | Right-click during drag | Original wire restored |
| DRAG-05 | Invalid target | Drag to same node or incompatible pin | Wire rejected, returns to original or deletes |

---

### 6. Comment Node Code Output

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| CMT-01 | Single line comment | Add Comment node with "Test comment" | Generated code contains `# Test comment` |
| CMT-02 | Multi-line comment | Add Comment with "Line 1\nLine 2" | Generated code has `# Line 1` and `# Line 2` |
| CMT-03 | Empty comment | Add Comment node with empty text | No output in generated code |
| CMT-04 | Comment position | Place comment above a node | Comment appears before that node's code |

---

### 7. Dropdown Visibility (Regression Check)

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| DROP-01 | ReadProperty dropdown | Add ReadProperty, select Temperature | "Temperature" visible when dropdown closed |
| DROP-02 | Compare dropdown | Add Compare, select "Greater Than (>)" | Selection visible when closed |
| DROP-03 | Increment dropdown | Add Increment, change to Decrement | Selection visible when closed |

---

## Known Issues (Not Fixed This Release)

- "Loop" is a reserved word - use "MainLoop" instead
- Simulator doesn't animate VS nodes during execution (Phase 2 feature)

---

## MCP Test Commands

For testing via MCP, use these commands:

```
# Create a script with DEVICE
basic10_set_code with:
DEVICE sensor "StructureGasSensor"
DEVICE cooler "StructureWallCooler"

MainLoop:
    IF sensor.Temperature > 295 THEN
        cooler.On = 1
    ELSE
        cooler.On = 0
    ENDIF
    YIELD
    GOTO MainLoop

# Compile and check for errors
basic10_compile

# Start simulator
basic10_simulator_start

# Step through and check device values
basic10_simulator_step
basic10_simulator_get_state
```

---

## Pass/Fail Summary

| Category | Tests | Pass | Fail | Notes |
|----------|-------|------|------|-------|
| Simulator Aliases | 6 | 0 | 6 | ❌ Alias resolution NOT working - `l r2 sensor Temperature` does not load value |
| Device Pool | 5 | - | - | Not tested (depends on alias fix) |
| Wire Keyboard | 5 | 5 | 0 | ✅ All methods work |
| Wire Menu | 3 | 3 | 0 | ✅ All methods work |
| Wire Drag | 5 | 5 | 0 | ✅ All methods work |
| Comments | 4 | 4 | 0 | ✅ Single, multi-line, empty, position all work |
| Dropdowns | 3 | 3 | 0 | ✅ Visibility bug FIXED |
| **TOTAL** | **31** | **20** | **6** | 5 not tested |

---

## Test Results Details

### Simulator Alias Resolution - FAILED ❌

**Test performed:**
1. Set code with `DEVICE sensor "StructureGasSensor"` and `DEVICE cooler "StructureWallCooler"`
2. Compiled successfully - IC10 generates `l r2 sensor Temperature`
3. Started simulator, set d0.Temperature = 300
4. Stepped through code
5. **Result:** r2 stayed at 0, branch was incorrectly taken (300 > 295 should NOT branch)
6. cooler.On = 0 (should be 1)

**Root cause:** The simulator does not resolve the alias "sensor" to d0. The `l r2 sensor Temperature` instruction fails silently.

### Wire Removal - PASSED ✅

All three methods confirmed working by user:
- Keyboard (Delete key)
- Right-click context menu
- Drag to disconnect

### Comment Node - PASSED ✅

- Single line: `# Test comment` ✅
- Multi-line: `# Line 1` and `# Line 2` on separate lines ✅
- Empty: No output ✅
- Position: Comment appears before subsequent nodes ✅

### Dropdown Visibility - PASSED ✅

- ReadProperty shows "Temperature" when closed ✅
- Compare shows "Greater Than (>)" when closed ✅
- Increment shows type selection when closed ✅

---

**End of Test Results**
