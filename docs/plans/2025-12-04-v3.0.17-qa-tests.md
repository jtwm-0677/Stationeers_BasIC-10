# QA Test Plan: v3.0.17 Simulator Loop Mode

**Version:** 3.0.17
**Date:** 2025-12-04
**Focus:** Simulator loop mode for continuous execution with YIELD handling

---

## Background

v3.0.17 adds a Loop button to the simulator that enables continuous execution, automatically resuming after YIELD instructions to mimic real IC chip behavior in Stationeers.

---

## Test Suite: Loop Mode

### 1. Basic Loop Functionality

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| LOOP-01 | Loop button visible | Open simulator | Purple "Loop" button in toolbar |
| LOOP-02 | Start loop | Click Loop button | Status shows "Looping", button changes to "Stop Loop" |
| LOOP-03 | Stop loop | Click "Stop Loop" | Status returns to "Paused", button returns to "Loop" |
| LOOP-04 | Loop counter appears | Start loop, wait for yield | "Loops: N" counter appears in status bar |

### 2. YIELD Handling

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| YIELD-01 | Auto-resume after yield | Loop script with YIELD | Continues after yield pause |
| YIELD-02 | Yield pause status | During yield pause | Status shows "Looping (yield pause)" |
| YIELD-03 | Loop count increments | Complete multiple yields | Counter increases with each yield |
| YIELD-04 | Speed slider affects pause | Adjust speed slider | Lower = longer pause, Higher = shorter pause |

**Test Script:**
```basic
DEVICE sensor "StructureGasSensor"
VAR temp = 0

MainLoop:
    temp = sensor.Temperature
    IF temp > 295 THEN
        sensor.On = 1
    ELSE
        sensor.On = 0
    ENDIF
    YIELD
    GOTO MainLoop
```

### 3. Device Interaction During Loop

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| DEV-01 | Edit device during pause | While looping, change sensor.Temperature | Value updates |
| DEV-02 | Script responds to change | After editing, continue loop | Script uses new value |
| DEV-03 | Multiple cycles | Let loop run 5+ cycles, change temp | Correct On/Off response |

### 4. Loop Control Interactions

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| CTRL-01 | Stop during loop | Click Stop while looping | Loop stops, status "Halted" |
| CTRL-02 | Reset during loop | Click Reset while looping | Loop stops, counter resets to 0 |
| CTRL-03 | Step after loop | Stop loop, then Step | Normal step behavior |
| CTRL-04 | Run after loop | Stop loop, then Run | Normal run until yield |
| CTRL-05 | Close window during loop | Close simulator while looping | Window closes cleanly |

### 5. Error Handling

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| ERR-01 | Script with error | Loop script that causes error | Loop stops, error shown |
| ERR-02 | Script without yield | Loop script that halts | Loop stops at halt |

---

## Regression Tests

| Test ID | Test Case | Expected Result |
|---------|-----------|-----------------|
| REG-01 | Step button | Still works normally |
| REG-02 | Run button | Runs until yield/halt |
| REG-03 | Pause button | Pauses execution |
| REG-04 | Reset button | Resets simulator |
| REG-05 | Register editing | Values can be edited |
| REG-06 | Device editing | Properties can be edited |

---

## Pass/Fail Summary

| Category | Tests | Pass | Fail | Notes |
|----------|-------|------|------|-------|
| Basic Loop | 4 | | | |
| YIELD Handling | 4 | | | |
| Device Interaction | 3 | | | |
| Loop Control | 5 | | | |
| Error Handling | 2 | | | |
| Regression | 6 | | | |
| **TOTAL** | **24** | | | |

---

## Quick Start Test

**Fastest way to verify loop mode works:**

1. Open Basic-10 v3.0.17
2. Paste this code:
```basic
VAR count = 0
MainLoop:
    count = count + 1
    YIELD
    GOTO MainLoop
```
3. Compile (F5)
4. Open Simulator (F6)
5. Click "Loop" button
6. Watch:
   - Status shows "Looping" (purple)
   - `count` register increments
   - "Loops: N" counter increases
   - Status briefly shows "Looping (yield pause)" between iterations
7. Click "Stop Loop"
8. Verify execution stops

If the loop runs continuously and the counter increments, loop mode is working!

---

## UI Elements Added

- **Loop Button** - Purple icon, toggles between "Loop" / "Stop Loop"
- **Loop Counter** - "Loops: N" in status bar (visible when looping or after looping)
- **Status Text** - "Looping" (purple) or "Looping (yield pause)" during operation

---

## Changes in v3.0.17

### Modified Files
- `UI/SimulatorWindow.xaml` - Added Loop button and loop counter
- `UI/SimulatorWindow.xaml.cs` - Added loop timer, loop state, Loop_Click handler
- `Simulator/IC10Simulator.cs` - Added Resume() method

---

**End of Test Plan**
