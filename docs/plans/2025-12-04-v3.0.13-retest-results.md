# QA Retest Results: v3.0.13 Simulator Alias Resolution

**Test Date:** 2025-12-04 11:30
**Tester:** Claude Code (QA Instance)
**Build:** v3.0.13 (new build from developer)
**Test Method:** Visual Scripting interface via MCP

---

## Test Objective

Retest SIM-01 to SIM-06 and POOL-01 to POOL-05 after developer applied fixes for simulator alias resolution.

---

## Test 1: NamedDevice (DEVICE) Alias Resolution

### Setup
- Created VS script with NamedDevice nodes
- sensor: `DEVICE sensor "StructureGasSensor"`
- cooler: `DEVICE cooler "StructureWallCooler"`

### Generated Code
```basic
DEVICE sensor "StructureGasSensor"
DEVICE cooler "StructureWallCooler"

MainLoop:
IF (sensor.Temperature > 295) THEN
    cooler.On = 1
ELSE
    cooler.On = 0
ENDIF
YIELD
GOTO MainLoop
```

### Compiled IC10
```ic10
move r0 -1252983604  # DEVICE sensor hash
move r1 -739292323   # DEVICE cooler hash
MainLoop:
l r2 sensor Temperature
ble r2 295 10
s cooler On 1
j 11
s cooler On 0
yield
j MainLoop
```

### Simulator Test
1. Started simulator
2. Set d0.Temperature = 300
3. Ran simulation (20 instructions max)

### Results

| Check | Expected | Actual | Status |
|-------|----------|--------|--------|
| d0.Temperature | 300 | 300 | Set correctly |
| r2 (sensor.Temperature) | 300 | **0** | **FAIL** |
| d1.On (cooler.On) | 1 | **0** | **FAIL** |

### Verdict: **FAILED**

The simulator does not resolve `sensor` or `cooler` aliases in IC10 instructions.

---

## Test 2: PinDevice (ALIAS) - Control Test

### Setup
- Created VS script with PinDevice nodes
- sensor: `ALIAS sensor d0`
- cooler: `ALIAS cooler d1`

### Generated Code
```basic
ALIAS sensor d0
ALIAS cooler d1

MainLoop:
IF (sensor.Temperature > 295) THEN
    cooler.On = 1
ELSE
    cooler.On = 0
ENDIF
YIELD
GOTO MainLoop
```

### Compiled IC10
```ic10
MainLoop:
l r0 d0 Temperature
ble r0 295 8
s d1 On 1
j 9
s d1 On 0
yield
j MainLoop
```

### Simulator Test
1. Started simulator
2. Set d0.Temperature = 300
3. Ran simulation (20 instructions max)

### Results

| Check | Expected | Actual | Status |
|-------|----------|--------|--------|
| d0.Temperature | 300 | 300 | Set correctly |
| r0 (d0.Temperature) | 300 | **300** | **PASS** |
| d1.On | 1 | **1** | **PASS** |

### Verdict: **PASSED**

Direct device references (d0, d1) work correctly in the simulator.

---

## POOL-01 to POOL-05: Device Pool Tests

**Status:** Not tested

**Reason:** Device pool operations depend on named device alias resolution, which is not working.

---

## Summary

| Test Category | Status | Notes |
|---------------|--------|-------|
| SIM-01 to SIM-06 (NamedDevice) | **FAILED** | Alias names not resolved |
| SIM-01 to SIM-06 (PinDevice) | **PASSED** | Direct d0-d5 refs work |
| POOL-01 to POOL-05 | **SKIPPED** | Depends on alias fix |

---

## Technical Analysis

The issue is in how the simulator parses IC10 instructions:

**Working:** `l r0 d0 Temperature`
- Simulator recognizes `d0` as device index 0
- Reads Temperature property correctly

**Not Working:** `l r2 sensor Temperature`
- Simulator does not map `sensor` alias to any device
- Instruction silently fails, r2 stays at 0

### Required Fix

The simulator needs to:
1. Parse the DEVICE declarations at the start of IC10
2. Build a mapping: `sensor` -> device slot (or hash)
3. When executing `l r2 sensor Temperature`, resolve `sensor` to the correct device

---

## Files Created This Session

- VS script with 14 nodes (NamedDevice version)
- VS script with 14 nodes (PinDevice version)

---

**End of Report**
