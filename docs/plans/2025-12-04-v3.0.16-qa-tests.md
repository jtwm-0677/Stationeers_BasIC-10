# QA Test Plan: v3.0.16 Wire Animations & MCP Named Device Tools

**Version:** 3.0.16
**Date:** 2025-12-04
**Focus:** Wire animation support in Visual Scripting and MCP named device property access

---

## Background

v3.0.16 adds two features:
1. **Wire Animations** - Visual feedback for data flow in Visual Scripting
2. **MCP Named Device Tools** - Ability to get/set properties on named devices (DEVICE statement aliases) via MCP

---

## Test Suite A: Wire Animations (Visual Scripting)

### 1. Basic Animation Support

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| WIRE-01 | Animation infrastructure | Open Visual Scripting, add nodes with wire | Wire renders normally |
| WIRE-02 | Wire hover state | Hover over a wire | Wire highlights (lighter blue) |
| WIRE-03 | Wire selection state | Click on a wire | Wire turns selection blue (rgb 0,120,215) |
| WIRE-04 | Wire normal color | Wire without interaction | Gray stroke, 2px thickness |

### 2. Animation Methods (Internal)

| Test ID | Test Case | Expected Behavior |
|---------|-----------|-------------------|
| WIRE-05 | StartAnimation() | Creates animated dash pattern, brightens wire color, 3px thickness |
| WIRE-06 | StopAnimation() | Removes dash pattern, restores normal state |
| WIRE-07 | Pulse() | Single flash animation (300ms default) |
| WIRE-08 | IsAnimating property | True when animating, false otherwise |

**Note:** Animation methods are currently internal infrastructure. Visual integration with simulator is planned for future release.

---

## Test Suite B: MCP Named Device Tools

### 1. Tool Availability

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| MCP-01 | List tools | Run `basic10_list_tools` or check MCP endpoint | Shows `basic10_simulator_set_named_device`, `basic10_simulator_get_named_device`, `basic10_simulator_list_named_devices` |

### 2. Set Named Device Property

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| MCP-02 | Set valid property | Call `basic10_simulator_set_named_device` with aliasName="sensor", property="Temperature", value=350 | Success, returns simulator state |
| MCP-03 | Set On property | Call with property="On", value=1 | sensor.On becomes 1 |
| MCP-04 | Invalid alias | Call with non-existent aliasName | Returns error: "Named device not found: {aliasName}" |

**MCP Call Example:**
```json
{
  "aliasName": "sensor",
  "property": "Temperature",
  "value": 350
}
```

### 3. Get Named Device Property

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| MCP-05 | Get Temperature | Call `basic10_simulator_get_named_device` with aliasName="sensor", property="Temperature" | Returns { aliasName, prefabName, property, value } |
| MCP-06 | Get unknown property | Call with property="FakeProperty" | Returns 0 (default value) |
| MCP-07 | Invalid alias | Call with non-existent aliasName | Returns error message |

**Expected Response:**
```json
{
  "success": true,
  "aliasName": "sensor",
  "prefabName": "StructureGasSensor",
  "property": "Temperature",
  "value": 350
}
```

### 4. List Named Devices

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| MCP-08 | List all devices | Call `basic10_simulator_list_named_devices` | Returns list with count and device info |
| MCP-09 | Device properties | Check returned device info | Each device has aliasName, prefabName, hash, and properties dictionary |
| MCP-10 | Empty list | Call before loading script with DEVICE statements | Returns count: 0, devices: [] |

**Expected Response:**
```json
{
  "count": 2,
  "devices": [
    {
      "aliasName": "sensor",
      "prefabName": "StructureGasSensor",
      "hash": 12345,
      "properties": {
        "Temperature": 293.15,
        "Pressure": 101.325,
        "On": 0
      }
    },
    {
      "aliasName": "cooler",
      "prefabName": "StructureWallCooler",
      "hash": 67890,
      "properties": {
        "On": 0,
        "Temperature": 293.15
      }
    }
  ]
}
```

### 5. HTTP API Endpoints

| Test ID | Endpoint | Method | Expected Result |
|---------|----------|--------|-----------------|
| API-01 | `/api/simulator/named-device` | POST | Sets named device property |
| API-02 | `/api/simulator/named-device/{aliasName}/{property}` | GET | Gets named device property |
| API-03 | `/api/simulator/named-devices` | GET | Lists all named devices |

---

## Test Suite C: Integration Tests

### 1. MCP + Simulator Flow

| Test ID | Test Case | Steps | Expected Result |
|---------|-----------|-------|-----------------|
| INT-01 | Full workflow | 1. Set code with DEVICE statement<br>2. Compile<br>3. Start simulator<br>4. List named devices<br>5. Set property via MCP<br>6. Step simulator<br>7. Get property via MCP | Property reflects the set value, simulator uses it |
| INT-02 | Multiple devices | Script has `DEVICE sensor "..."` and `DEVICE cooler "..."` | Both appear in list, can set/get independently |
| INT-03 | Property persistence | Set property via MCP, reset simulator, set code, compile, start | Property should be set from fresh (reparse DEVICE from code) |

**Test Script:**
```basic
DEVICE sensor "StructureGasSensor"
DEVICE cooler "StructureWallCooler"
VAR temp = 0

MainLoop:
    temp = sensor.Temperature
    IF temp > 295 THEN
        cooler.On = 1
    ELSE
        cooler.On = 0
    ENDIF
    YIELD
    GOTO MainLoop
```

---

## Regression Tests

Verify these still work after changes:

| Test ID | Test Case | Expected Result |
|---------|-----------|-----------------|
| REG-01 | Pin device set (`basic10_simulator_set_device`) | Works for d0-d5 |
| REG-02 | Pin device get (`basic10_simulator_get_device`) | Works for d0-d5 |
| REG-03 | Simulator step/run | Works as before |
| REG-04 | Visual scripting node add/remove | Works as before |
| REG-05 | Visual scripting wire connect/disconnect | Works as before |
| REG-06 | lb/sb instructions (from v3.0.15) | Still executes correctly |

---

## Pass/Fail Summary

| Category | Tests | Pass | Fail | Notes |
|----------|-------|------|------|-------|
| Wire Animations | 8 | | | |
| MCP Set Named Device | 3 | | | |
| MCP Get Named Device | 3 | | | |
| MCP List Named Devices | 3 | | | |
| HTTP API Endpoints | 3 | | | |
| Integration | 3 | | | |
| Regression | 6 | | | |
| **TOTAL** | **29** | | | |

---

## Quick Start Test

**Fastest way to verify the MCP named device tools work:**

1. Open Basic-10 v3.0.16
2. Paste this code:
```basic
DEVICE sensor "StructureGasSensor"
VAR temp = 0
temp = sensor.Temperature
```
3. Compile (F5)
4. Open Simulator (F6)
5. Use MCP tool `basic10_simulator_list_named_devices`
   - Should show `sensor` with its properties
6. Use MCP tool `basic10_simulator_set_named_device` with:
   - aliasName: "sensor"
   - property: "Temperature"
   - value: 500
7. In simulator device list, verify `sensor.Temperature` shows `500`
8. Step simulator 3 times
9. Verify `temp` register shows `500`

If `temp` shows `500`, the MCP named device tools are working!

---

## Changes in v3.0.16

### New Files
- None (all changes to existing files)

### Modified Files
- `UI/VisualScripting/Canvas/WireVisual.cs` - Added animation support
- `Basic10.Mcp/HttpBridge.cs` - Added named device methods and response models
- `Basic10.Mcp/McpServer.cs` - Added tool definitions and handlers
- `Services/HttpApiServer.cs` - Added API endpoints
- `Services/EditorBridgeService.cs` - Added bridge methods
- `UI/MainWindow.xaml.cs` - Added API implementation and result types
- `Simulator/VirtualDevice.cs` - Added Hash property and GetAllProperties method

---

**End of Test Plan**
