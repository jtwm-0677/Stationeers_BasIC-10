# Test Plan: v3.0.20 Bug Fixes

**Version:** 3.0.20
**Date:** 2025-12-04
**Author:** Claude Code (Development Instance)
**Features:** Fix for BUG-001 (VS code not syncing compiled IC10 to main editor)

---

## Summary

This release fixes BUG-001 from v3.0.19 testing:
- **BUG-001**: When VS-generated code was sent to the main editor, the IC10/MIPS output panel displayed BASIC source code instead of compiled IC10 assembly.

---

## Changes Made

### 1. VS Code Sync Fix
**File:** `UI/MainWindow.xaml.cs`

**Root Cause:** The `VisualScripting_BasicCodeGenerated` event handler only set `BasicEditor.Text` with the BASIC code. It did not set `MipsOutput.Text` with the compiled IC10 code, relying instead on auto-compile which may not trigger if disabled or suppressed.

**Fix:**
- Now explicitly sets both `BasicEditor.Text` (BASIC) and `MipsOutput.Text` (IC10)
- Uses `_suppressBasicUpdate` flag to prevent auto-compile loop (since VS already compiled)
- Uses `_suppressMipsUpdate` flag to prevent MipsOutput TextChanged event loops

**Before:**
```csharp
private void VisualScripting_BasicCodeGenerated(object? sender, BasicCodeGeneratedEventArgs e)
{
    if (!string.IsNullOrWhiteSpace(e.BasicCode))
    {
        Dispatcher.Invoke(() =>
        {
            BasicEditor.Text = e.BasicCode;
            SetStatus("Code synced from Visual Scripting", true);
        });
    }
}
```

**After:**
```csharp
private void VisualScripting_BasicCodeGenerated(object? sender, BasicCodeGeneratedEventArgs e)
{
    if (!string.IsNullOrWhiteSpace(e.BasicCode))
    {
        Dispatcher.Invoke(() =>
        {
            _suppressBasicUpdate = true;
            BasicEditor.Text = e.BasicCode;
            _suppressBasicUpdate = false;

            if (!string.IsNullOrWhiteSpace(e.IC10Code))
            {
                _suppressMipsUpdate = true;
                MipsOutput.Text = e.IC10Code;
                _suppressMipsUpdate = false;
            }

            SetStatus("Code synced from Visual Scripting", true);
        });
    }
}
```

---

## Test Environment

- **OS:** Windows 10/11 x64
- **Runtime:** .NET 8.0
- **Application:** Basic_10.exe v3.0.20

---

## Test Cases

### VS-SYNC-01: VS Code Syncs Both Panels
| Item | Value |
|------|-------|
| **Objective** | Verify VS-generated code syncs BASIC and IC10 to main editor |
| **Steps** | 1. Open Visual Scripting<br>2. Create simple script (e.g., Entry Point + Comment)<br>3. VS generates code and syncs to editor<br>4. Check both editor panels |
| **Expected** | - Left panel (BASIC): Shows BASIC source code<br>- Right panel (IC10): Shows compiled IC10 assembly (move, add, j, etc.)<br>- Panels show DIFFERENT content |
| **Priority** | Critical |

---

### VS-SYNC-02: AutoCompile Off Still Works
| Item | Value |
|------|-------|
| **Objective** | Verify VS sync works even with AutoCompile disabled |
| **Steps** | 1. Disable AutoCompile (uncheck menu option)<br>2. Open Visual Scripting<br>3. Create simple script<br>4. Check both editor panels |
| **Expected** | - BASIC panel: Shows BASIC source<br>- IC10 panel: Shows compiled IC10 assembly<br>- Both correctly populated regardless of AutoCompile setting |
| **Priority** | High |

---

### VS-SYNC-03: Complex Script Sync
| Item | Value |
|------|-------|
| **Objective** | Verify complex VS scripts sync correctly |
| **Steps** | 1. Open Visual Scripting<br>2. Create script with: NamedDevice, IF statement, Math operation<br>3. Check both editor panels |
| **Expected** | - BASIC: Shows complete script with ALIAS, IF/ENDIF, etc.<br>- IC10: Shows compiled assembly with alias, bne/beq, add, yield, j, etc. |
| **Priority** | High |

---

### VS-SYNC-04: IC10 Line Count Correct
| Item | Value |
|------|-------|
| **Objective** | Verify IC10 output has expected instruction count |
| **Steps** | 1. Create VS script that generates known code<br>2. Compare IC10 line count with expected |
| **Expected** | IC10 line count matches expected compiled output |
| **Priority** | Medium |

---

### REGRESSION-01: Default Script Still Works
| Item | Value |
|------|-------|
| **Objective** | Regression - verify default script still compiles |
| **Steps** | 1. Launch Basic_10.exe fresh<br>2. Press F5 to compile |
| **Expected** | Compiles successfully, no errors |
| **Priority** | Critical |

---

### REGRESSION-02: Manual Compile Still Works
| Item | Value |
|------|-------|
| **Objective** | Regression - verify manual compile unaffected by changes |
| **Steps** | 1. Type BASIC code manually<br>2. Press F5 to compile<br>3. Check IC10 output |
| **Expected** | Manual typing and compile works as before |
| **Priority** | High |

---

### REGRESSION-03: Simulator Runs VS Code
| Item | Value |
|------|-------|
| **Objective** | Verify VS-synced IC10 code runs in simulator |
| **Steps** | 1. Create VS script with YIELD<br>2. Open Simulator (F9)<br>3. Click Run |
| **Expected** | - Executes without errors<br>- Reaches YIELD instruction<br>- Status shows "Yielding" |
| **Priority** | High |

---

### REGRESSION-04: Loop Mode Regression
| Item | Value |
|------|-------|
| **Objective** | Regression - verify Loop mode still works (from v3.0.18) |
| **Steps** | 1. Create looping script with YIELD<br>2. Compile<br>3. Open Simulator<br>4. Click Loop |
| **Expected** | - Continuous execution<br>- Auto-resume after YIELD<br>- "Looping" status shown |
| **Priority** | High |

---

## Pass/Fail Criteria

### Pass
- All Critical priority tests pass
- All High priority tests pass
- No regressions from v3.0.19

### Conditional Pass
- All Critical tests pass
- Minor issues in Medium priority tests (documented for future fix)

### Fail
- Any Critical test fails
- Multiple High priority tests fail
- BUG-001 not fixed

---

## Related Documents

- **Previous Test Plan:** `2025-12-04-v3.0.19-bugfixes.md`
- **Previous Test Results:** `../test results/2025-12-04-v3.0.19-bugfixes-results.md`
- **Bug Reference:** BUG-001 (VS code not compiling to IC10)

---

**End of Test Plan**
