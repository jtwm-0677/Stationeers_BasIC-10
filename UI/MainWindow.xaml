<Window x:Class="BasicToMips.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:avalon="http://icsharpcode.net/sharpdevelop/avalonedit"
        xmlns:local="clr-namespace:BasicToMips.UI"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="Stationeers Basic-10 By Dog Tired Studios"
        Icon="/icon.ico"
        Height="900" Width="1400"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource MainWindowStyle}"
        Loaded="Window_Loaded"
        Closing="Window_Closing">

    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Control" Command="{Binding NewFileCommand}"/>
        <KeyBinding Key="O" Modifiers="Control" Command="{Binding OpenFileCommand}"/>
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding SaveFileCommand}"/>
        <KeyBinding Key="S" Modifiers="Control+Shift" Command="{Binding SaveAsCommand}"/>
        <KeyBinding Key="F5" Command="{Binding CompileCommand}"/>
        <KeyBinding Key="F1" Command="{Binding ShowHelpCommand}"/>
        <KeyBinding Key="F6" Command="{Binding ToggleSnippetsCommand}"/>
        <KeyBinding Key="F7" Command="{Binding ToggleSimulatorCommand}"/>
        <KeyBinding Key="Space" Modifiers="Control" Command="{Binding TriggerAutocompleteCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <DockPanel Grid.Row="0" Background="{StaticResource SecondaryBackgroundBrush}">
            <Menu Background="Transparent">
            <MenuItem Header="_File">
                <MenuItem Header="_New" InputGestureText="Ctrl+N" Click="NewFile_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE8A5;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Open..." InputGestureText="Ctrl+O" Click="OpenFile_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Save" InputGestureText="Ctrl+S" Click="SaveFile_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Save _As..." InputGestureText="Ctrl+Shift+S" Click="SaveFileAs_Click"/>
                <MenuItem Header="_Export IC10..." Click="ExportIC10_Click"/>
                <Separator/>
                <MenuItem Header="Recent Files" x:Name="RecentFilesMenu"/>
                <Separator/>
                <MenuItem Header="Import IC10..." Click="ImportIC10_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE8B5;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Import IC10 from Clipboard" Click="ImportIC10FromClipboard_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE77F;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="E_xit" InputGestureText="Alt+F4" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Undo" InputGestureText="Ctrl+Z" Click="Undo_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE7A7;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Redo" InputGestureText="Ctrl+Y" Click="Redo_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE7A6;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Cu_t" InputGestureText="Ctrl+X" Click="Cut_Click"/>
                <MenuItem Header="_Copy" InputGestureText="Ctrl+C" Click="Copy_Click"/>
                <MenuItem Header="_Paste" InputGestureText="Ctrl+V" Click="Paste_Click"/>
                <Separator/>
                <MenuItem Header="_Find..." InputGestureText="Ctrl+F" Click="Find_Click"/>
                <MenuItem Header="_Replace..." InputGestureText="Ctrl+H" Click="Replace_Click"/>
                <Separator/>
                <MenuItem Header="Insert _Snippet" x:Name="SnippetsMenu"/>
                <Separator/>
                <MenuItem Header="_Format Document" InputGestureText="Ctrl+Shift+F" Click="FormatDocument_Click"/>
            </MenuItem>
            <MenuItem Header="_Build">
                <MenuItem Header="_Compile" InputGestureText="F5" Click="Compile_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE768;" FontFamily="Segoe MDL2 Assets" FontSize="14" Foreground="{StaticResource SuccessBrush}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Compile and _Copy IC10" InputGestureText="F6" Click="CompileAndCopy_Click"/>
                <Separator/>
                <MenuItem Header="_Run Simulator..." InputGestureText="F9" Click="RunSimulator_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xEBE8;" FontFamily="Segoe MDL2 Assets" FontSize="14" Foreground="{StaticResource InfoBrush}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Optimization Level">
                    <MenuItem Header="None (Fastest compile)" x:Name="OptNone" IsCheckable="True" Click="OptLevel_Click"/>
                    <MenuItem Header="Basic (Recommended)" x:Name="OptBasic" IsCheckable="True" IsChecked="True" Click="OptLevel_Click"/>
                    <MenuItem Header="Aggressive (Smallest output)" x:Name="OptAggressive" IsCheckable="True" Click="OptLevel_Click"/>
                </MenuItem>
                <MenuItem Header="Output _Mode">
                    <MenuItem Header="Readable (Default)" x:Name="OutputModeReadable" IsCheckable="True" IsChecked="True" Click="OutputMode_Click"
                              ToolTip="Preserve comments and formatting"/>
                    <MenuItem Header="Compact" x:Name="OutputModeCompact" IsCheckable="True" Click="OutputMode_Click"
                              ToolTip="Strip comments and minimize whitespace for smallest output"/>
                    <MenuItem Header="Debug" x:Name="OutputModeDebug" IsCheckable="True" Click="OutputMode_Click"
                              ToolTip="Include source line numbers on each instruction"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Auto-compile on _Save" x:Name="AutoCompileMenu" IsCheckable="True" IsChecked="True" Click="AutoCompileMenu_Click"/>
                <MenuItem Header="Auto-complete _Suggestions" x:Name="AutoCompleteMenu" IsCheckable="True" IsChecked="True" Click="AutoCompleteMenu_Click"
                          ToolTip="Show auto-complete suggestions when typing (Ctrl+Space)"/>
                <MenuItem Header="Include Source _Line Numbers" x:Name="SourceLineCommentsMenu" IsCheckable="True" IsChecked="False"
                          ToolTip="Append BASIC source line numbers as comments on each IC10 instruction"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Show _Symbols Panel" x:Name="ShowSymbolsMenu" IsCheckable="True" IsChecked="True" Click="ToggleSymbols_Click" InputGestureText="F4"/>
                <MenuItem Header="Show _Documentation Panel" x:Name="ShowDocsMenu" IsCheckable="True" IsChecked="True" Click="ToggleDocs_Click"/>
                <MenuItem Header="Show _Snippets Panel" x:Name="ShowSnippetsMenu" IsCheckable="True" Click="ToggleSnippets_Click" InputGestureText="F6"/>
                <MenuItem Header="Show S_imulator Window" x:Name="ShowSimulatorMenu" IsCheckable="True" Click="ToggleSimulator_Click" InputGestureText="F7"/>
                <MenuItem Header="Show _Watch Window" x:Name="ShowWatchMenu" IsCheckable="True" Click="ToggleWatch_Click" InputGestureText="F8"/>
                <MenuItem Header="Show Variable _Inspector" x:Name="ShowVariableInspectorMenu" IsCheckable="True" Click="ToggleVariableInspector_Click" InputGestureText="F9"/>
                <Separator/>
                <MenuItem Header="Show _Line Numbers" x:Name="ShowLineNumbersMenu" IsCheckable="True" IsChecked="True" Click="ToggleLineNumbers_Click"/>
                <MenuItem Header="Word _Wrap" x:Name="WordWrapMenu" IsCheckable="True" Click="ToggleWordWrap_Click"/>
                <Separator/>
                <MenuItem Header="Split _View">
                    <MenuItem Header="Horizontal Split (Top/Bottom)" x:Name="SplitHorizontalMenu" IsCheckable="True" IsChecked="True" Click="SplitView_Click"/>
                    <MenuItem Header="Vertical Split (Side by Side)" x:Name="SplitVerticalMenu" IsCheckable="True" Click="SplitView_Click"/>
                    <MenuItem Header="Editor Only (Hide IC10)" x:Name="SplitEditorOnlyMenu" IsCheckable="True" Click="SplitView_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Retro Effects">
                    <MenuItem Header="_Block Cursor" x:Name="BlockCursorMenu" IsCheckable="True" IsChecked="True" Click="ToggleBlockCursor_Click"
                              ToolTip="Classic BASIC-style block cursor"/>
                    <MenuItem Header="Current _Line Highlight" x:Name="CurrentLineHighlightMenu" IsCheckable="True" IsChecked="True" Click="ToggleCurrentLineHighlight_Click"
                              ToolTip="Subtle highlight on the current line"/>
                    <MenuItem Header="_Scanline Overlay" x:Name="ScanlineOverlayMenu" IsCheckable="True" Click="ToggleScanlineOverlay_Click"
                              ToolTip="Faint CRT-style scanlines"/>
                    <MenuItem Header="Screen _Glow" x:Name="ScreenGlowMenu" IsCheckable="True" Click="ToggleScreenGlow_Click"
                              ToolTip="Subtle phosphor glow effect"/>
                    <MenuItem Header="Retro _Font" x:Name="RetroFontMenu" IsCheckable="True" Click="ToggleRetroFont_Click"
                              ToolTip="Classic programming font style"/>
                    <MenuItem Header="Font _Style">
                        <MenuItem Header="Default (Consolas)" x:Name="FontDefaultMenu" IsCheckable="True" IsChecked="True" Click="FontStyle_Click" Tag="Default"/>
                        <MenuItem Header="Apple II" x:Name="FontAppleMenu" IsCheckable="True" Click="FontStyle_Click" Tag="Apple"/>
                        <MenuItem Header="TRS-80" x:Name="FontTRS80Menu" IsCheckable="True" Click="FontStyle_Click" Tag="TRS80"/>
                    </MenuItem>
                    <MenuItem Header="Startup _Beep" x:Name="StartupBeepMenu" IsCheckable="True" Click="ToggleStartupBeep_Click"
                              ToolTip="Classic BASIC 'READY' beep on launch"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Zoom In" InputGestureText="Ctrl++" Click="ZoomIn_Click"/>
                <MenuItem Header="Zoom _Out" InputGestureText="Ctrl+-" Click="ZoomOut_Click"/>
                <MenuItem Header="_Reset Zoom" Click="ZoomReset_Click"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="_Device Hash Database..." Click="DeviceDatabase_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE8F1;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Settings..." Click="Settings_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE713;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Syntax _Colors..." Click="SyntaxColors_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE790;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Set _Scripts Location..." Click="SetStationeersDir_Click"/>
                <MenuItem Header="_Open Stationeers Scripts Folder" Click="OpenScriptsFolder_Click"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_Documentation" InputGestureText="F1" Click="ShowDocs_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE897;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Quick Start Guide" Click="QuickStart_Click"/>
                <MenuItem Header="_Language Reference" Click="LangRef_Click"/>
                <MenuItem Header="_Examples" Click="Examples_Click"/>
                <Separator/>
                <MenuItem Header="Check for _Updates..." Click="CheckUpdates_Click"/>
                <MenuItem Header="_About" Click="About_Click"/>
            </MenuItem>
        </Menu>
        </DockPanel>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="{StaticResource SecondaryBackgroundBrush}" Padding="4,2" BorderBrush="{StaticResource SeparatorBrush}" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <Button Style="{StaticResource IconButtonStyle}" ToolTip="New (Ctrl+N)" Click="NewFile_Click">
                    <TextBlock Text="&#xE8A5;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                </Button>
                <Button Style="{StaticResource IconButtonStyle}" ToolTip="Open (Ctrl+O)" Click="OpenFile_Click">
                    <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                </Button>
                <Button Style="{StaticResource IconButtonStyle}" ToolTip="Save (Ctrl+S)" Click="SaveFile_Click">
                    <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                </Button>

                <Rectangle Width="1" Fill="{StaticResource SeparatorBrush}" Margin="8,4"/>

                <Button Style="{StaticResource IconButtonStyle}" ToolTip="Undo (Ctrl+Z)" Click="Undo_Click">
                    <TextBlock Text="&#xE7A7;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                </Button>
                <Button Style="{StaticResource IconButtonStyle}" ToolTip="Redo (Ctrl+Y)" Click="Redo_Click">
                    <TextBlock Text="&#xE7A6;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                </Button>

                <Rectangle Width="1" Fill="{StaticResource SeparatorBrush}" Margin="8,4"/>

                <Button Style="{StaticResource IconButtonStyle}" ToolTip="Find (Ctrl+F)" Click="Find_Click">
                    <TextBlock Text="&#xE721;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                </Button>

                <Rectangle Width="1" Fill="{StaticResource SeparatorBrush}" Margin="8,4"/>

                <Button x:Name="CompileButton" Style="{StaticResource PrimaryButtonStyle}" Padding="12,4" ToolTip="Compile (F5)" Click="Compile_Click">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE768;" FontFamily="Segoe MDL2 Assets" FontSize="14" VerticalAlignment="Center"/>
                        <TextBlock Text=" Compile" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Style="{StaticResource IconButtonStyle}" ToolTip="Copy IC10 to Clipboard" Click="CopyIC10_Click" Margin="4,0,0,0">
                    <TextBlock Text="&#xE8C8;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                </Button>

                <Rectangle Width="1" Fill="{StaticResource SeparatorBrush}" Margin="8,4"/>

                <CheckBox x:Name="AutoCompileCheckBox" Content="Auto-compile" IsChecked="True"
                          VerticalAlignment="Center" Margin="4,0"
                          Foreground="White"
                          ToolTip="Automatically compile when code changes"
                          Checked="AutoCompileCheckBox_Changed" Unchecked="AutoCompileCheckBox_Changed"/>
                <CheckBox x:Name="AutoCompleteCheckBox" Content="Auto-complete" IsChecked="True"
                          VerticalAlignment="Center" Margin="4,0"
                          Foreground="White"
                          ToolTip="Show auto-complete suggestions when typing"
                          Checked="AutoCompleteCheckBox_Changed" Unchecked="AutoCompleteCheckBox_Changed"/>
            </StackPanel>
        </Border>

        <!-- Banner overlay spanning menu and toolbar -->
        <Image Grid.Row="0" Grid.RowSpan="2"
               Source="/Basic-10Banner.png"
               Height="90"
               HorizontalAlignment="Right"
               VerticalAlignment="Top"
               Margin="0,0,8,0"
               Panel.ZIndex="100"
               RenderOptions.BitmapScalingMode="HighQuality"/>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" x:Name="SymbolsPanelColumn"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="300" x:Name="DocsPanelColumn"/>
            </Grid.ColumnDefinitions>

            <!-- Symbols Panel (Variables, Labels, etc.) -->
            <Border Grid.Column="0" Background="{StaticResource SidebarBackgroundBrush}" Width="180" x:Name="SymbolsPanel">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{StaticResource TertiaryBackgroundBrush}" Padding="8,6">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8F4;" FontFamily="Segoe MDL2 Assets" FontSize="12" Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center"/>
                                <TextBlock Text=" Symbols" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" Margin="4,0,0,0"/>
                            </StackPanel>
                            <Button Grid.Column="1" Style="{StaticResource IconButtonStyle}" Padding="2" ToolTip="Close Symbols Panel" Click="CloseSymbols_Click">
                                <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                            </Button>
                        </Grid>
                    </Border>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="4">
                        <StackPanel x:Name="SymbolsListPanel">
                            <!-- Variables Section -->
                            <Expander Header="Variables" IsExpanded="True" Margin="0,0,0,4">
                                <StackPanel x:Name="VariablesListPanel"/>
                            </Expander>
                            <!-- Constants Section -->
                            <Expander Header="Constants" IsExpanded="True" Margin="0,0,0,4">
                                <StackPanel x:Name="ConstantsListPanel"/>
                            </Expander>
                            <!-- Labels Section -->
                            <Expander Header="Labels" IsExpanded="True" Margin="0,0,0,4">
                                <StackPanel x:Name="LabelsListPanel"/>
                            </Expander>
                            <!-- Aliases Section -->
                            <Expander Header="Aliases" IsExpanded="True" Margin="0,0,0,4">
                                <StackPanel x:Name="AliasesListPanel"/>
                            </Expander>
                            <!-- Arrays Section -->
                            <Expander Header="Arrays" IsExpanded="True" Margin="0,0,0,4">
                                <StackPanel x:Name="ArraysListPanel"/>
                            </Expander>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Symbols Panel Splitter -->
            <GridSplitter Grid.Column="1" Width="4" HorizontalAlignment="Center" Background="{StaticResource TertiaryBackgroundBrush}" Cursor="SizeWE" x:Name="SymbolsSplitter"/>

            <!-- Editor Area -->
            <Grid Grid.Column="2" x:Name="EditorGrid">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" MinHeight="150" x:Name="BasicEditorRow"/>
                    <RowDefinition Height="Auto" x:Name="EditorSplitterRow"/>
                    <RowDefinition Height="*" MinHeight="150" x:Name="MipsOutputRow"/>
                </Grid.RowDefinitions>

                <!-- BASIC Editor Panel -->
                <Border Grid.Row="0" Background="{StaticResource EditorBackgroundBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- BASIC Editor Header -->
                        <Border Grid.Row="0" Background="{StaticResource TertiaryBackgroundBrush}" Padding="12,6">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="&#xE943;" FontFamily="Segoe MDL2 Assets" FontSize="14" Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Text=" BASIC Source" FontWeight="SemiBold" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                    <TextBlock x:Name="BasicFileNameText" Text="" Foreground="{StaticResource SecondaryTextBrush}" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                    <TextBlock x:Name="ModifiedIndicator" Text="*" Foreground="{StaticResource WarningBrush}" VerticalAlignment="Center" Visibility="Collapsed"/>
                                </StackPanel>
                                <TextBlock Grid.Column="1" x:Name="BasicLineCountText" Text="Lines: 0" Foreground="{StaticResource SecondaryTextBrush}" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- BASIC Editor -->
                        <avalon:TextEditor x:Name="BasicEditor"
                                          Grid.Row="1"
                                          FontFamily="{StaticResource CodeFont}"
                                          FontSize="14"
                                          Background="{StaticResource EditorBackgroundBrush}"
                                          Foreground="{StaticResource PrimaryTextBrush}"
                                          LineNumbersForeground="{StaticResource SecondaryTextBrush}"
                                          ShowLineNumbers="True"
                                          VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Auto"
                                          Padding="4"
                                          TextChanged="BasicEditor_TextChanged"/>
                    </Grid>
                </Border>

                <!-- Splitter -->
                <GridSplitter x:Name="EditorSplitter" Grid.Row="1" Height="6" HorizontalAlignment="Stretch" Background="{StaticResource TertiaryBackgroundBrush}" Cursor="SizeNS"/>

                <!-- MIPS Output Panel -->
                <Border x:Name="MipsOutputPanel" Grid.Row="2" Background="{StaticResource EditorBackgroundBrush}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- MIPS Output Header -->
                        <Border Grid.Row="0" Background="{StaticResource TertiaryBackgroundBrush}" Padding="12,6">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="&#xE756;" FontFamily="Segoe MDL2 Assets" FontSize="14" Foreground="{StaticResource SuccessBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Text=" IC10 MIPS" FontWeight="SemiBold" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                    <TextBlock x:Name="MipsEditableIndicator" Text=" (Editable)" Foreground="{StaticResource SecondaryTextBrush}" VerticalAlignment="Center" FontStyle="Italic" FontSize="12"/>
                                    <Button x:Name="DecompileButton" Style="{StaticResource IconButtonStyle}" ToolTip="Decompile to BASIC" Click="Decompile_Click" Margin="8,0,0,0" Padding="4,2">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                                            <TextBlock Text=" To BASIC" FontSize="11" Margin="4,0,0,0"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <TextBlock x:Name="MipsLineCountText" Text="Lines: 0 / 128" Foreground="{StaticResource SecondaryTextBrush}" VerticalAlignment="Center"/>
                                    <Border x:Name="LineWarningBadge" Background="{StaticResource WarningBrush}" CornerRadius="4" Padding="6,2" Margin="8,0,0,0" Visibility="Collapsed">
                                        <TextBlock Text="Near limit!" FontSize="11" Foreground="#1E1E1E"/>
                                    </Border>
                                    <Border x:Name="LineErrorBadge" Background="{StaticResource ErrorBrush}" CornerRadius="4" Padding="6,2" Margin="8,0,0,0" Visibility="Collapsed">
                                        <TextBlock Text="Over limit!" FontSize="11" Foreground="White"/>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- MIPS Output (Now Editable) -->
                        <avalon:TextEditor x:Name="MipsOutput"
                                          Grid.Row="1"
                                          FontFamily="{StaticResource CodeFont}"
                                          FontSize="14"
                                          Background="{StaticResource EditorBackgroundBrush}"
                                          Foreground="{StaticResource PrimaryTextBrush}"
                                          LineNumbersForeground="{StaticResource SecondaryTextBrush}"
                                          ShowLineNumbers="True"
                                          VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Auto"
                                          Padding="4"
                                          TextChanged="MipsOutput_TextChanged"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- Docs Panel Splitter -->
            <GridSplitter Grid.Column="3" Width="6" HorizontalAlignment="Center" Background="{StaticResource TertiaryBackgroundBrush}" Cursor="SizeWE" x:Name="DocsSplitter"/>

            <!-- Documentation Panel -->
            <Border Grid.Column="4" Background="{StaticResource SidebarBackgroundBrush}" x:Name="DocsPanel">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Docs Header -->
                    <Border Grid.Row="0" Background="{StaticResource TertiaryBackgroundBrush}" Padding="12,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE82D;" FontFamily="Segoe MDL2 Assets" FontSize="14" Foreground="{StaticResource InfoBrush}" VerticalAlignment="Center"/>
                                <TextBlock Text=" Documentation" FontWeight="SemiBold" VerticalAlignment="Center" Margin="4,0,0,0"/>
                            </StackPanel>
                            <Button Grid.Column="1" Style="{StaticResource IconButtonStyle}" Padding="4" ToolTip="Close Documentation" Click="CloseDocs_Click">
                                <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Docs Content - Comprehensive Reference Tabs -->
                    <TabControl Grid.Row="1" Background="Transparent" BorderThickness="0" x:Name="DocsTabControl">
                        <!-- Tab 1: Start Here - For Complete Beginners -->
                        <TabItem Header="Start" ToolTip="Getting Started Guide">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="6">
                                <StackPanel x:Name="StartHerePanel">
                                    <!-- Populated dynamically -->
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                        <!-- Tab 2: Syntax - Complete Language Reference -->
                        <TabItem Header="Syntax" ToolTip="Language Syntax Reference">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="6">
                                <StackPanel x:Name="SyntaxPanel">
                                    <!-- Populated dynamically -->
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                        <!-- Tab 3: Functions - All Built-in Functions -->
                        <TabItem Header="Funcs" ToolTip="Built-in Functions">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="6">
                                <StackPanel x:Name="FunctionsPanel">
                                    <!-- Populated dynamically -->
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                        <!-- Tab 4: Devices - Device Properties & Batch Ops -->
                        <TabItem Header="Devices" ToolTip="Device Properties &amp; Operations">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="6">
                                <StackPanel x:Name="DevicesPanel">
                                    <!-- Populated dynamically -->
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                        <!-- Tab 5: IC10 Reference - MIPS Instructions -->
                        <TabItem Header="IC10" ToolTip="IC10 MIPS Instruction Reference">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="6">
                                <StackPanel x:Name="IC10Panel">
                                    <!-- Populated dynamically -->
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                        <!-- Tab 6: Patterns - Tips, Tricks & Common Patterns -->
                        <TabItem Header="Tips" ToolTip="Tips, Tricks &amp; Patterns">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="6">
                                <StackPanel x:Name="PatternsPanel">
                                    <!-- Populated dynamically -->
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                        <!-- Tab 7: Examples -->
                        <TabItem Header="Examples" ToolTip="Working Code Examples">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="6">
                                <StackPanel x:Name="ExamplesPanel">
                                    <!-- Populated dynamically -->
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                        <!-- Tab 8: Wiki - Live Stationeers Wiki -->
                        <TabItem Header="Wiki" ToolTip="Stationeers Wiki">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <!-- Wiki Navigation Bar with Address Bar -->
                                <Border Grid.Row="0" Background="{StaticResource TertiaryBackgroundBrush}" Padding="4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <!-- Navigation Buttons -->
                                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                                            <Button x:Name="WikiBackButton" Style="{StaticResource IconButtonStyle}" Click="WikiBack_Click" ToolTip="Back" Padding="6,4">
                                                <TextBlock Text="&#xE72B;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                                            </Button>
                                            <Button x:Name="WikiForwardButton" Style="{StaticResource IconButtonStyle}" Click="WikiForward_Click" ToolTip="Forward" Padding="6,4">
                                                <TextBlock Text="&#xE72A;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                                            </Button>
                                            <Button Style="{StaticResource IconButtonStyle}" Click="WikiRefresh_Click" ToolTip="Refresh" Padding="6,4">
                                                <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                                            </Button>
                                            <Button Style="{StaticResource IconButtonStyle}" Click="WikiHome_Click" ToolTip="Stationeers Wiki Home" Padding="6,4">
                                                <TextBlock Text="&#xE80F;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                                            </Button>
                                        </StackPanel>
                                        <!-- Address Bar -->
                                        <TextBox x:Name="WikiAddressBar" Grid.Column="1"
                                                 Text="https://stationeers-wiki.com/Main_Page"
                                                 VerticalAlignment="Center"
                                                 Margin="6,0"
                                                 Padding="6,4"
                                                 FontSize="11"
                                                 KeyDown="WikiAddressBar_KeyDown"
                                                 ToolTip="Enter URL and press Enter to navigate"/>
                                        <!-- Go Button -->
                                        <Button Grid.Column="2" Style="{StaticResource IconButtonStyle}" Click="WikiGo_Click" ToolTip="Go to URL" Padding="8,4">
                                            <TextBlock Text="&#xE768;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                                        </Button>
                                    </Grid>
                                </Border>
                                <!-- Wiki Browser -->
                                <wv2:WebView2 x:Name="WikiBrowser" Grid.Row="1"
                                              Source="https://stationeers-wiki.com/Main_Page"
                                              NavigationCompleted="WikiBrowser_NavigationCompleted"/>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </Border>
        </Grid>

        <!-- Note: Simulator is now a floating window (SimulatorWindow.xaml) -->

        <!-- Snippets Popup Panel (floating over editor) -->
        <Border x:Name="SnippetsPopup" Grid.Row="2"
                Background="{StaticResource SidebarBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Width="280" Height="400"
                HorizontalAlignment="Left" VerticalAlignment="Top"
                Margin="200,50,0,0"
                Visibility="Collapsed">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="{StaticResource TertiaryBackgroundBrush}" Padding="8,6" CornerRadius="4,4,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE8ED;" FontFamily="Segoe MDL2 Assets" FontSize="12" Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center"/>
                            <TextBlock Text=" Code Snippets" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" Margin="4,0,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Style="{StaticResource IconButtonStyle}" Padding="2" ToolTip="Close" Click="CloseSnippetsPanel_Click">
                            <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                        </Button>
                    </Grid>
                </Border>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="4">
                    <StackPanel x:Name="SnippetsPanelList"/>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Note: Watch panel is now a floating window (WatchWindow.xaml) -->

        <!-- Bottom Action Bar -->
        <Border Grid.Row="3" Background="{StaticResource SecondaryBackgroundBrush}" Padding="12,8" BorderBrush="{StaticResource SeparatorBrush}" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Error/Warning Panel -->
                <Border x:Name="ErrorPanel" Background="{StaticResource TertiaryBackgroundBrush}" CornerRadius="4" Padding="12,6" Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock x:Name="ErrorIcon" Text="&#xEA39;" FontFamily="Segoe MDL2 Assets" FontSize="14" Foreground="{StaticResource ErrorBrush}" VerticalAlignment="Center"/>
                        <TextBlock x:Name="ErrorText" Text="" Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Style="{StaticResource ModernButtonStyle}" Content="Load Example" Click="LoadExample_Click" Margin="0,0,8,0"/>
                    <Button Style="{StaticResource ModernButtonStyle}" Content="Optimize" Click="Optimize_Click" Margin="0,0,8,0"/>
                    <Button Style="{StaticResource PrimaryButtonStyle}" Content="Save &amp; Deploy" Click="SaveAndDeploy_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <StatusBar Grid.Row="4">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="StatusIcon" Text="&#xE73E;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center"/>
                    <TextBlock x:Name="StatusText" Text="Ready" Margin="6,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </StatusBarItem>
            <Separator Background="#FFFFFF" Opacity="0.3"/>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="&#xE8B7;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" ToolTip="Working Directory"/>
                    <TextBlock x:Name="WorkingDirectoryText" Text="Unsaved script" Margin="6,0,0,0" VerticalAlignment="Center" Opacity="0.8" FontStyle="Italic"/>
                </StackPanel>
            </StatusBarItem>
            <Separator Background="#FFFFFF" Opacity="0.3"/>
            <StatusBarItem>
                <TextBlock x:Name="CursorPositionText" Text="Ln 1, Col 1"/>
            </StatusBarItem>
            <Separator Background="#FFFFFF" Opacity="0.3"/>
            <StatusBarItem>
                <TextBlock x:Name="StationeersPathText" Text="Stationeers: Not configured" Opacity="0.8"/>
            </StatusBarItem>
            <Separator Background="#FFFFFF" Opacity="0.3"/>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="IC10: " VerticalAlignment="Center"/>
                    <Border x:Name="LineBudgetIndicator" CornerRadius="3" Padding="8,2" Background="#00C853">
                        <TextBlock x:Name="LineBudgetText" Text="0/128" Foreground="White" FontWeight="SemiBold"/>
                    </Border>
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="VersionText" Text="Stationeers Basic-10"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
